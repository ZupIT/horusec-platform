package vulnerability

import (
	"errors"
	entityVulnerability "github.com/ZupIT/horusec-devkit/pkg/entities/vulnerability"
	entity "github.com/ZupIT/horusec-platform/vulnerability/internal/entities/vulnerability"
	"github.com/ZupIT/horusec-platform/vulnerability/internal/repositories/vulnerability"
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestController_FindAllVulnerabilityByFilter(t *testing.T) {
	t.Run("Should return all vulnerabilities without error", func(t *testing.T) {
		repoMock := &vulnerability.Mock{}
		repoMock.On("FindAllVulnerabilitiesByFilter").Return(&entity.FindVulnerabilities{
			TotalItems: 1,
			Data: []entityVulnerability.Vulnerability{{}},
		}, nil)
		result, err := NewVulnerabilitiesController(repoMock).FindAllVulnerabilityByFilter(&entity.FilterToFindAllVulnerabilities{})
		assert.NoError(t, err)
		assert.NotEmpty(t, result)
	})
	t.Run("Should return all vulnerabilities with error", func(t *testing.T) {
		repoMock := &vulnerability.Mock{}
		repoMock.On("FindAllVulnerabilitiesByFilter").Return(&entity.FindVulnerabilities{}, errors.New("unexpected error"))
		result, err := NewVulnerabilitiesController(repoMock).FindAllVulnerabilityByFilter(&entity.FilterToFindAllVulnerabilities{})
		assert.Equal(t, errors.New("unexpected error"), err)
		assert.Empty(t, result)
	})
}